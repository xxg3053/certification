function toFixed2(e){return parseFloat(+e.toFixed(2))}function fireEvent(e,t){var n;return document.createEventObject?(n=document.createEventObject(),e.fireEvent("on"+t,n)):(n=document.createEvent("HTMLEvents"),n.initEvent(t,!0,!0),!e.dispatchEvent(n))}window.onerror=function(e,t,n,r,o){setTimeout(function(){var a={"错误信息：":e,"出错文件：":t,"出错行号：":n,"出错列号：":r,"错误详情：":o};alert("出错了，下一步将显示错误信息"),alert(JSON.stringify(a,null,10))})},[].forEach.call(document.querySelectorAll("[data-src]"),function(e){!function(e){e.addEventListener("click",function(){e.src="img/loading.gif",lrz(e.dataset.src).then(function(t){return e.src=t.base64,t})}),fireEvent(e,"click")}(e)}),document.querySelector("input").addEventListener("change",function(){var e="",t=this,n=document.querySelector("progress");lrz(t.files[0],{width:800}).then(function(r){var o=new Image,a=document.createElement("div"),i=document.createElement("input"),c=toFixed2(t.files[0].size/1024),s=toFixed2(r.fileLen/1024),l=parseInt(100-s/c*100);'源文件：<span class="text-danger">!{sourceSize}KB</span> <br>压缩后传输大小：<span class="text-success">!{resultSize}KB (省!{effect}%)</span> '.render({sourceSize:c,resultSize:s,effect:l});i.name="imgName",i.className="hide",i.value="",a.className="img-box",a.appendChild(i),a.appendChild(o),o.onload=function(){$("#upload-container").find(".img-box").size()>0&&$("#upload-container").find(".img-box")[0].remove(),$(".page6 .photo span").remove(),i.value=e,document.querySelector("#upload-container").appendChild(a)},n.value=0,$(".page6 progress").show();var u=new XMLHttpRequest;if(u.open("POST","../service/upload.php"),u.onload=function(){var i=JSON.parse(u.response);e=i.data.fname,200===u.status?(o.src=r.base64,n.value=0,$(".page6 progress").hide()):(alert(i.msg),a.remove(),t.value=null)},u.onerror=function(e){alert("未知错误:"+JSON.stringify(e,null,2)),a.remove(),t.value=null},u.upload)try{u.upload.addEventListener("progress",function(e){return e.lengthComputable?void(n.value=100*(e.loaded/e.total||0)):!1})}catch(d){console.error("进度展示出错了,似乎不支持此特性?",d)}return r.formData.append("fileLen",r.fileLen),r.formData.append("xxx","我是其他参数"),u.send(r.formData),r})}),String.prototype.render=function(e){var t,n=this;return Object.keys(e).forEach(function(r){t=new RegExp("\\!\\{"+r+"\\}","g"),n=n.replace(t,e[r])}),n},String.prototype.render=function(e){var t,n=this;return Object.keys(e).forEach(function(r){t=new RegExp("\\!\\{"+r+"\\}","g"),n=n.replace(t,e[r])}),n},"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode.removeChild(this)});