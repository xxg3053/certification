function toFixed2(e){return parseFloat(+e.toFixed(2))}function fireEvent(e,n){var t;return document.createEventObject?(t=document.createEventObject(),e.fireEvent("on"+n,t)):(t=document.createEvent("HTMLEvents"),t.initEvent(n,!0,!0),!e.dispatchEvent(t))}window.onerror=function(e,n,t,r,o){setTimeout(function(){})},[].forEach.call(document.querySelectorAll("[data-src]"),function(e){!function(e){e.addEventListener("click",function(){e.src="img/loading.gif",lrz(e.dataset.src).then(function(n){return e.src=n.base64,n})}),fireEvent(e,"click")}(e)}),document.querySelector("input").addEventListener("change",function(){var e="",n=this,t=document.querySelector("progress");lrz(n.files[0],{width:800}).then(function(r){var o=new Image,a=document.createElement("div"),i=document.createElement("input"),c=toFixed2(n.files[0].size/1024),s=toFixed2(r.fileLen/1024),u=parseInt(100-s/c*100);'源文件：<span class="text-danger">!{sourceSize}KB</span> <br>压缩后传输大小：<span class="text-success">!{resultSize}KB (省!{effect}%)</span> '.render({sourceSize:c,resultSize:s,effect:u});i.name="imgName",i.className="hide",i.value="",a.className="img-box",a.appendChild(i),a.appendChild(o),o.onload=function(){$("#upload-container").find(".img-box").size()>0&&$("#upload-container").find(".img-box")[0].remove(),$(".page6 .photo span").remove(),i.value=e,document.querySelector("#upload-container").appendChild(a)},t.value=0,$(".page6 progress").show(),$(".page6 .loading-img").show();var l=new XMLHttpRequest;if(l.open("POST","../service/upload.php"),l.onload=function(){var i=JSON.parse(l.response);e=i.data.fname,200===l.status?(o.src=r.base64,t.value=0,$(".page6 progress").hide(),$(".page6 .loading-img").hide()):(alert(i.msg),a.remove(),n.value=null)},l.onerror=function(e){alert("未知错误:"+JSON.stringify(e,null,2)),a.remove(),n.value=null},l.upload)try{l.upload.addEventListener("progress",function(e){return e.lengthComputable?void(t.value=100*(e.loaded/e.total||0)):!1})}catch(d){console.error("进度展示出错了,似乎不支持此特性?",d)}return r.formData.append("fileLen",r.fileLen),r.formData.append("xxx","我是其他参数"),l.send(r.formData),r})}),String.prototype.render=function(e){var n,t=this;return Object.keys(e).forEach(function(r){n=new RegExp("\\!\\{"+r+"\\}","g"),t=t.replace(n,e[r])}),t},String.prototype.render=function(e){var n,t=this;return Object.keys(e).forEach(function(r){n=new RegExp("\\!\\{"+r+"\\}","g"),t=t.replace(n,e[r])}),t},"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode.removeChild(this)});